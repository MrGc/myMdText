# IM系统设计



> 一般来说首先需要制定好消息内容和未读书的存储。另外需要建立比原业务系统更加高效实时的消息发送通道，当然也包括依托第三方辅助通道来提升消息到达率。



IM系统大体需要做的工作

#### 消息的存储

一般来说，大部分即时消息系统为了方便查看历史消息或者用于暂存离线消息，都需要对消息进行服务端存储。

##### 消息索引和消息内容

**点对点的消息参与方有两个：消息发送方和消息接收方。**收发双方的历史消息都是相互独立的。相互独立的意思是指：假设发送方删除了某一条消息，接收方仍然可以获取到这条消息。

所以从库表设计分析，索引表收发双方各自有一条自己的索引记录。一条是消息发送方的发件箱索引，另一条是消息接收方的收件箱索引。

由于收发双方看到的内容是一致的。因此还需要一个独立的消息内容表。

* 内容表

  | 消息ID | 消息内容 | 消息类型 | 消息产生时间 |
  | ------ | -------- | -------- | ------------ |
  | 1001   | 你好呀   | 文本消息 | 2022-3-19    |
  |        |          |          |              |

  

* 